<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twitch Sound List</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: linear-gradient(270deg in oklab, #4d480a, #120b49, #410d47, #043306);
    background-size: 400% 400%;
    animation: gradientBG 60s linear infinite alternate;
    transition: background 0.5s ease, color 0.5s ease;
    color: transparent;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Light mode override */
  body.lightmode {
    background: linear-gradient(270deg in oklab, #e2d522, #3b27f0, #cc26e2, #18d821);
    background-size: 400% 400%;
    animation: gradientBG 60s linear infinite alternate;
    color: transparent;
  }

  /* Sound item cards with frosted glass effect */
  .sound-item {
    display: flex;
    align-items: center;
    margin: 10px 0;
    padding: 10px;
    border: 2px solid #000; /* default border */
    border-radius: 12px;    /* rounded edges */
    background: rgba(0,0,0,0.3); /* dark overlay */
    backdrop-filter: blur(6px);   /* frosted glass effect */
    transition: background 0.5s ease, border-color 0.5s ease, color 0.5s ease;
  }

  .sound-item img { 
    width: 50px; 
    height: 50px; 
    object-fit: contain; 
    margin-right: 15px; 
    border-radius: 5px; 
    background: transparent; 
  }

  .sound-item button { 
    margin-left: auto; 
    padding: 5px 10px; 
    cursor: pointer; 
    transition: transform 0.2s ease; 
  }

  .sound-item button:hover {
    transform: scale(1.2);
  }

  #twitchImg:hover {
  transform: scale(1.2);
  transition: transform 0.2s ease;
}

  .sound-item div {
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
  }

  /* Light mode override for cards */
  body.lightmode .sound-item {
    border: 5px solid #000;
    background: rgba(255,255,255,0.6); 
    border-color: #000;
  }

  body.lightmode .sound-item div {
    color: #000; 
    text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
  }

  body.lightmode .sound-item a {
    color: #000;
  }

  .sound-item a {
    color: #fff;
    text-decoration: underline;
  }

  .container { max-width: 900px; margin: 0 auto; }
  .dropdown { margin-bottom: 20px; padding: 5px; }
  
  /* Header color and light/dark mode support */
.container > h1 {
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    margin-bottom: 15px;
}

body.lightmode .container > h1 {
    color: #000;
    text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
}

</style>
</head>
<body>
<div class="container">
  <h1>Emote Sounds</h1>

  <button id="toggleMode" aria-label="Toggle light/dark mode" 
          style="margin-bottom:15px;padding:5px;cursor:pointer;font-size:20px;background:none;border:none;">
    ðŸŒ™
  </button>


  <!-- This MUST exist -->
  <div id="list"></div>
</div>



<script>
// Local JSON files stored in the repo
const userFiles = {
  Amedoll: "lists/Amedoll.json",
  Boshiitime: "lists/BoshiiTime.json",
  Favorite: "lists/Favorite.json",
  Fubuki_Vr: "lists/Fubuki_Vr.json",
  Greywolf: "lists/Greywolf.json",
  HeyImRadiant: "lists/HeyImRadiant.json",
  Jakkuba_VR: "lists/Jakkuba_VR.json",
  Kasimina: "lists/Kasimina.json",
  Kohrean: "lists/Kohrean.json",
  Krisuna: "lists/Krisuna.json",
  Kromia: "lists/Kromia.json",
  La_Wafflez: "lists/La_Wafflez.json",
  Luuna: "lists/Luuna.json",
  Puck: "lists/Puck.json",
  RinMunchkin: "lists/RinMunchkin.json",
  SKTKawaiiNeko: "lists/SKTKawaiiNeko.json",
  Taletrap: "lists/Taletrap.json",
  Totless: "lists/Totless.json"
};

// Toggle dark/light mode
const toggleBtn = document.getElementById("toggleMode");
toggleBtn.addEventListener("click", () => {
  document.body.classList.toggle("lightmode");
  toggleBtn.textContent = document.body.classList.contains("lightmode") ? "â˜€ï¸" : "ðŸŒ™";
});

let triggerImages = {};



async function loadTriggerImages() {
  try {
    const res = await fetch("lists/internals/IconTriggers.json");
    triggerImages = await res.json();
    console.log("Loaded trigger images:", triggerImages);
  } catch (err) {
    console.error("Failed to load trigger images:", err);
  }
}

loadTriggerImages();

let avatars = {};

async function loadAvatars() {
  try {
    const res = await fetch("lists/internals/avatars.json");
    avatars = await res.json();
    console.log("Loaded avatars:", avatars);
  } catch (err) {
    console.error("Failed to load avatars:", err);
  }
}

loadAvatars();


// Load available user lists on page load
window.addEventListener("DOMContentLoaded", async () => {
  await loadTriggerImages();
  displayUserLists();
});


function displayUserLists() {
  const container = document.getElementById("list");
  container.innerHTML = "";

  Object.keys(userFiles).forEach(user => {
    const div = document.createElement("div");
    div.className = "sound-item";
    div.style.cursor = "pointer";

    // Twitch avatar
    const twitchImg = document.createElement("img");
    twitchImg.src = avatars[user] || "https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png";
    twitchImg.alt = user;

// Fetch avatar from Twitch API


    // Twitch profile link (clickable avatar)
    const twitchLink = document.createElement("a");
    twitchLink.href = `https://twitch.tv/${user}`;
    twitchLink.target = "_blank";
    twitchLink.appendChild(twitchImg);
    div.appendChild(twitchLink);

    // Text label
    const text = document.createElement("div");
    text.innerHTML = `<strong>${user}</strong><br><span>Click to view sounds</span>`;
    div.appendChild(text);

    // Click the container to load userâ€™s sound list
    div.addEventListener("click", (e) => {
      // prevent triggering when clicking twitch link
      if (e.target.tagName.toLowerCase() === 'img' || e.target.closest('a')) return;
      loadList(user);
    });

    container.appendChild(div);
  });
}

// Load list for selected user
async function loadList(user) {
  try {
    const res = await fetch(userFiles[user]);
    const data = await res.json();

    const list = Array.isArray(data)
      ? data
      : Object.values(data).find(v => Array.isArray(v)) || [];

    displayList(list, user);
  } catch (error) {
    console.error("Error loading list:", error);
    document.getElementById("list").innerHTML = "<p style='color:red;'>Failed to load list.</p>";
  }
}

// Display the actual emote sound list
function displayList(list, user) {
    const container = document.getElementById("list");
    container.innerHTML = ''; // clear the container first

    // 1ï¸âƒ£ Back button
    const backButton = document.createElement("button");
    backButton.id = "backButton";
    backButton.style.marginBottom = "15px";
    backButton.style.padding = "8px 12px";
    backButton.style.fontSize = "16px";
    backbutton.style.color = "#fff"
    backButton.style.borderRadius = "8px";
    backButton.style.border = "2px solid #000";
    backButton.style.background = "rgba(0,0,0,0.3)";
    backButton.style.backdropFilter = "blur(6px)";
    backButton.style.cursor = "pointer";
    backButton.textContent = "â¬… Back";
    container.appendChild(backButton);
    backButton.addEventListener("click", () => displayUserLists());

    // 2ï¸âƒ£ Styled Search bar
    const searchInput = document.createElement("input");
    searchInput.type = "text";
    searchInput.placeholder = "Search emotes...";
    searchInput.style.marginBottom = "15px";
    searchInput.style.padding = "10px";
    searchInput.style.width = "100%";
    searchInput.style.fontSize = "16px";
    searchInput.style.borderRadius = "12px";
    searchInput.style.border = "2px solid #000";
    searchInput.style.background = "rgba(0,0,0,0.3)";
    searchInput.style.backdropFilter = "blur(6px)";
    searchInput.style.color = "#fff";
    searchInput.style.outline = "none";
    searchInput.style.transition = "all 0.3s ease";
    searchInput.addEventListener("focus", () => searchInput.style.borderColor = "#fff");
    searchInput.addEventListener("blur", () => searchInput.style.borderColor = "#000");
    container.appendChild(searchInput);

    if (list.length === 0) {
        container.innerHTML += "<p>No sounds found in this list.</p>";
        return;
    }

    // 3ï¸âƒ£ Store emote divs for filtering
    const emoteDivs = [];

    // 4ï¸âƒ£ Create emote divs
    list.forEach(item => {
        if (!item.enabled || item.enabled !== "true") return;

        const div = document.createElement("div");
        div.className = "sound-item";

        const emoteData = triggerImages[item.trigger_word];
        const emoteImgSrc = emoteData?.image || "https://cdn.7tv.app/emote/01FMT8FX5800071FCSB63SA4SJ/4x.avif";
        const emoteLink = emoteData?.link || "#";

        const emoteAnchor = document.createElement("a");
        emoteAnchor.href = emoteLink;
        emoteAnchor.target = "_blank";

        const emoteImg = document.createElement("img");
        emoteImg.src = emoteImgSrc;
        emoteImg.alt = item.trigger_word;
        emoteImg.style.cursor = "pointer";
        emoteImg.style.background = "transparent";

        emoteAnchor.appendChild(emoteImg);
        div.appendChild(emoteAnchor);

        const text = document.createElement("div");
        text.innerHTML = `<strong>${item.trigger_word}</strong><br><a href="${item.sound}" target="_blank">Sound Link</a>`;
        div.appendChild(text);

        // Make the whole div clickable to play sound
        div.style.cursor = "pointer";
        div.addEventListener("click", (e) => {
            if (e.target.tagName.toLowerCase() === 'a') return;
            const audioSrc = Array.isArray(item.sound)
                ? item.sound[Math.floor(Math.random() * item.sound.length)]
                : item.sound;
            const audio = new Audio(audioSrc);
            audio.volume = item.volume || 0.05;
            audio.play();
        });

        container.appendChild(div);

        // Add to emoteDivs array for search filtering
        emoteDivs.push({div, trigger_word: item.trigger_word.toLowerCase()});
    });

    // 5ï¸âƒ£ Filter on input
    searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();
        emoteDivs.forEach(obj => {
            obj.div.style.display = obj.trigger_word.includes(query) ? "flex" : "none";
        });
    });
}


</script>
</body>
</html>