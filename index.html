<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twitch Sound List</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: linear-gradient(270deg, #4d480a, #120b49, #410d47, #043306);
    background-size: 800% 800%;
    animation: gradientBG 40s ease infinite;
    transition: background 0.5s ease, color 0.5s ease;
    color: #fff;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Light mode override */
  body.lightmode {
    background: linear-gradient(270deg, #e2d522, #3b27f0, #cc26e2, #18d821);
    background-size: 800% 800%;
    animation: gradientBG 40s ease infinite;
    color: #000;
  }

  /* Sound item cards with frosted glass effect */
  .sound-item {
    display: flex;
    align-items: center;
    margin: 10px 0;
    padding: 10px;
    border: 2px solid #000; /* default border */
    border-radius: 12px;    /* rounded edges */
    background: rgba(0,0,0,0.3); /* dark overlay */
    backdrop-filter: blur(6px);   /* frosted glass effect */
    transition: background 0.5s ease, border-color 0.5s ease, color 0.5s ease;
  }

  .sound-item img { 
    width: 50px; 
    height: 50px; 
    object-fit: contain; 
    margin-right: 15px; 
    border-radius: 5px; 
    background: #fff; 
  }

  .sound-item button { 
    margin-left: auto; 
    padding: 5px 10px; 
    cursor: pointer; 
    transition: transform 0.2s ease; 
  }

  .sound-item button:hover {
    transform: scale(1.2);
  }

  #twitchImg:hover {
  transform: scale(1.2);
  transition: transform 0.2s ease;
}

  .sound-item div {
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
  }

  /* Light mode override for cards */
  body.lightmode .sound-item {
    background: rgba(255,255,255,0.6); 
    border-color: #000;
  }

  body.lightmode .sound-item div {
    color: #000; 
    text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
  }

  body.lightmode .sound-item a {
    color: #000;
  }

  .sound-item a {
    color: #fff;
    text-decoration: underline;
  }

  .container { max-width: 900px; margin: 0 auto; }
  .dropdown { margin-bottom: 20px; padding: 5px; }
</style>
</head>
<body>
<div class="container">
  <h1>Emote Sounds</h1>

  <button id="toggleMode" aria-label="Toggle light/dark mode" 
          style="margin-bottom:15px;padding:5px;cursor:pointer;font-size:20px;background:none;border:none;">
    ðŸŒ™
  </button>

  <!-- Dropdown + Twitch avatar flex row -->
  <div style="display:flex; align-items:center; margin-bottom:20px;">
    <select id="userSelect" class="dropdown">
      <option value="">Select a user/list</option>
    </select>

    <a id="twitchLink" href="#" target="_blank" style="display:none; margin-left:10px;">
      <img id="twitchImg" alt="Twitch Profile" 
           style="width:40px; height:40px; border-radius:50%; vertical-align:middle; cursor:pointer;">
    </a>
  </div>

  <!-- This MUST exist -->
  <div id="list"></div>
</div>



<script>
// Local JSON files stored in the repo
const userFiles = {
  Amedoll: "lists/Amedoll.json",
  Boshiitime: "lists/BoshiiTime.json",
  Favorite: "lists/Favorite.json",
  Fubuki_Vr: "lists/Fubuki_Vr.json",
  Greywolf: "lists/Greywolf.json",
  HeyImRadiant: "lists/HeyImRadiant.json",
  Jakkuba_VR: "lists/Jakkuba_VR.json",
  Kasimina: "lists/Kasimina.json",
  Kohrean: "lists/Kohrean.json",
  Krisuna: "lists/Krisuna.json",
  Kromia: "lists/Kromia.json",
  La_Wafflez: "lists/La_Wafflez.json",
  Luuna: "lists/Luuna.json",
  Puck: "lists/Puck.json",
  RinMunchkin: "lists/RinMunchkin.json",
  SKTKawaiiNeko: "lists/SKTKawaiiNeko.json",
  Taletrap: "lists/Taletrap.json",
  Totless: "lists/Totless.json"
};

const toggleBtn = document.getElementById("toggleMode");
toggleBtn.addEventListener("click", () => {
  document.body.classList.toggle("lightmode");

  // Change icon
  if (document.body.classList.contains("lightmode")) {
    toggleBtn.textContent = "â˜€ï¸"; // sun icon for light mode
  } else {
    toggleBtn.textContent = "ðŸŒ™"; // moon icon for dark mode
  }
});

let triggerImages = {};

async function loadTriggerImages() {
  try {
    const res = await fetch("lists/IconTriggers.json"); // path to your JSON
    triggerImages = await res.json();
    console.log("Loaded trigger images:", triggerImages);
  } catch (err) {
    console.error("Failed to load trigger images:", err);
  }
}

// Call it at the start
loadTriggerImages();


const defaultImage = "https://cdn.7tv.app/emote/01FMT8FX5800071FCSB63SA4SJ/4x.avif";

// Populate dropdown
const userSelect = document.getElementById("userSelect");
Object.keys(userFiles).forEach(user => {
  const option = document.createElement("option");
  option.value = user;
  option.textContent = user;
  userSelect.appendChild(option);
});

userSelect.addEventListener("change", () => {
  const user = userSelect.value;
  const twitchLink = document.getElementById("twitchLink");
  const twitchImg = document.getElementById("twitchImg");

  if(user) {
    loadList(user);

    // Show Twitch avatar and link
    twitchLink.href = `https://twitch.tv/${user}`;
    twitchLink.style.display = "inline-block";
    twitchImg.src = `https://static-cdn.jtvnw.net/jtv_user_pictures/${user}-profile_image-70x70.png`;

    // Update favicon dynamically
    let favicon = document.querySelector("link[rel='icon']");
    if (!favicon) {
      favicon = document.createElement("link");
      favicon.rel = "icon";
      document.head.appendChild(favicon);
    }
    favicon.href = twitchImg.src;

    // Fallback if avatar fails
    twitchImg.onerror = () => {
      twitchImg.src = "https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png";
      favicon.href = twitchImg.src;
    };
} else {
    twitchLink.style.display = "none";

    // Reset favicon to default Twitch icon
    let favicon = document.querySelector("link[rel='icon']");
    if (!favicon) {
      favicon = document.createElement("link");
      favicon.rel = "icon";
      document.head.appendChild(favicon);
    }
    favicon.href = "https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png";
}


});


// Fetch JSON from local file and display
async function loadList(user) {
  try {
    const res = await fetch(userFiles[user]);
    const data = await res.json();

    // Detect whether data is an array or an object with an array property
    const list = Array.isArray(data)
      ? data
      : Object.values(data).find(v => Array.isArray(v)) || [];

    displayList(list);
  } catch (error) {
    console.error("Error loading list:", error);
    document.getElementById("list").innerHTML = "<p style='color:red;'>Failed to load list.</p>";
  }
}

// Display list in the container
function displayList(list) {
  const container = document.getElementById("list");
  if (!container) {
    console.error("#list container not found in DOM");
    return;
  }
  container.innerHTML = "";
  
  if(list.length === 0){
    container.innerHTML = "<p>No sounds found in this list.</p>";
    return;
  }

  list.forEach(item => {
    if(!item.enabled || item.enabled !== "true") return;
    
    const div = document.createElement("div");
    div.className = "sound-item";
    
    const img = document.createElement("img");
    img.src = triggerImages[item.trigger_word] || defaultImage;
    div.appendChild(img);
    
    const text = document.createElement("div");
    text.innerHTML = `<strong>${item.trigger_word}</strong><br><a href="${item.sound}" target="_blank">Sound Link</a>`;
    div.appendChild(text);

    // Create button for play
    const btn = document.createElement("button");

    // Remove all button styling so it wraps the image tightly
      btn.style.background = "transparent";
      btn.style.border = "none";
      btn.style.padding = "0";
      btn.style.marginLeft = "auto"; // keeps it right-aligned
      btn.style.cursor = "pointer";
      btn.style.display = "inline-flex"; // shrink-wrap to content

    // Create an <img> element inside the button
      const playIcon = document.createElement("img");
        playIcon.src = "https://files.catbox.moe/o17kpq.png"; // your PNG link
        playIcon.alt = "Play sound";
        playIcon.style.width = "24px"; // adjust as needed
        playIcon.style.height = "24px";
        playIcon.style.display = "block"; // remove inline spacing
        playIcon.style.background = "transparent"
        playIcon.style.pointerEvents = "none"
      btn.appendChild(playIcon);

    btn.onclick = () => {
      let audioSrc;
      if (Array.isArray(item.sound)) {
        const randomIndex = Math.floor(Math.random() * item.sound.length);
        audioSrc = item.sound[randomIndex];
      } else {
        audioSrc = item.sound;
      }
      const audio = new Audio(audioSrc);
      audio.volume = item.volume || 0.05;
      audio.play();
    };
    div.appendChild(btn);
    
    container.appendChild(div);
  });


}
</script>
</body>
</html>