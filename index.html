<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twitch Sound List</title>

<style>
/* ====================== */
/*      GENERAL STYLES     */
/* ====================== */
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: linear-gradient(270deg in oklab, #4d480a, #120b49, #410d47, #043306);
  background-size: 400% 400%;
  animation: gradientBG 60s linear infinite alternate;
  transition: background 0.5s ease, color 0.5s ease;
  color: transparent;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Light mode */
body.lightmode {
  background: linear-gradient(270deg in oklab, #e2d522, #3b27f0, #cc26e2, #18d821);
  background-size: 400% 400%;
  animation: gradientBG 60s linear infinite alternate;
  color: transparent;
}

/* ====================== */
/*       CONTAINERS        */
/* ====================== */
.container {
  max-width: 900px;
  margin: 0 auto;
}

.container > h1 {
  color: #fff;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
  margin-bottom: 15px;
}
body.lightmode .container > h1 {
  color: #000;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
}

/* ====================== */
/*      SOUND ITEMS        */
/* ====================== */
.sound-item {
  display: flex;
  align-items: center;
  margin: 10px 0;
  padding: 10px;
  border: 2px solid #000;
  border-radius: 12px;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(6px);
  transition: background 0.5s ease, border-color 0.5s ease, color 0.5s ease;
}

.sound-item img {
  width: 50px;
  height: 50px;
  object-fit: contain;
  margin-right: 15px;
  border-radius: 5px;
  background: transparent;
}

.sound-item button {
  margin-left: auto;
  padding: 5px 10px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.sound-item button:hover {
  transform: scale(1.2);
}

.sound-item div {
  color: #fff;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
}

.sound-item a {
  color: #fff;
  text-decoration: underline;
}

/* Light mode for cards */
body.lightmode .sound-item {
  border: 5px solid #000;
  background: rgba(255,255,255,0.6);
}

body.lightmode .sound-item div {
  color: #000;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
}

body.lightmode .sound-item a {
  color: #000;
}

/* ====================== */
/*      CONTACT CARD       */
/* ====================== */
.contact-card {
  display: inline-block;
  padding: 15px;
  border-radius: 16px;
  border: 2px solid #000;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(6px);
  transition: all 0.3s ease;
}

.contact-card:hover {
  box-shadow: 0 0 20px rgba(255,255,255,0.8);
  transform: scale(1.05);
}

body.lightmode .contact-card {
  background: rgba(255,255,255,0.6);
  border: 2px solid #000;
}

body.lightmode .contact-card:hover {
  box-shadow: 0 0 20px rgba(0,0,0,0.7);
}

/* ====================== */
/*   TOGGLE DARK MODE      */
/* ====================== */
#toggleMode {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
}

/* ====================== */
/*       LOADING UI        */
/* ====================== */
.spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-left: auto;
  display: none;
}
body.lightmode .spinner {
  border: 3px solid rgba(0,0,0,0.3);
  border-top-color: black;
}
@keyframes spin { to { transform: rotate(360deg); } }

.loading {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
}
.loading svg polyline {
  fill: none;
  stroke-width: 3;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.loading svg polyline#back { stroke: #ff4d5033; }
.loading svg polyline#front {
  stroke: #ff4d4f;
  stroke-dasharray: 48, 144;
  stroke-dashoffset: 192;
  animation: dash_682 1.4s linear infinite;
}
@keyframes dash_682 {
  72.5% { opacity: 0; }
  to { stroke-dashoffset: 0; }
}
.spinner-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  border-radius: 12px;
  display: none;
}
body.lightmode .spinner-overlay {
  background: rgba(255,255,255,0.4);
}

/* ====================== */
/*    STOP / REVERSE BTN   */
/* ====================== */
.stop-btn, .reverse-btn {
  padding: 6px 10px;
  border-radius: 8px;
  backdrop-filter: blur(6px);
  background: rgba(255,255,255,0.1);
  border: 1px solid #fff;
  color: #fff;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}
.stop-btn:hover, .reverse-btn:hover { background: rgba(255,255,255,0.25); }
body.lightmode .stop-btn, body.lightmode .reverse-btn {
  background: rgba(0,0,0,0.1);
  border: 1px solid #000;
  color: #000;
}
body.lightmode .stop-btn:hover, body.lightmode .reverse-btn:hover {
  background: rgba(0,0,0,0.25);
}

</style>
</head>
<body>
<div class="container">
  <h1>Emote Sounds</h1>
  <button id="toggleMode">ðŸŒ™</button>
  <div id="list"></div>

  <!-- Contact Me Button -->
  <div style="text-align:center; margin-top:40px;">
    <a href="https://twitch.tv/windowsben" target="_blank" class="contact-card">
      <img src="https://files.catbox.moe/c65dyt.png" alt="Contact Me" style="width:120px; height:auto; border-radius:12px; cursor:pointer;">
    </a>
  </div>
</div>

<script>
/* ====================== */
/*       USER FILES        */
/* ====================== */
const userFiles = {
  Amedoll: "lists/Amedoll.json",
  Boshiitime: "lists/BoshiiTime.json",
  Favorite: "lists/Favorite.json",
  Fubuki_Vr: "lists/Fubuki_Vr.json",
  Greywolf: "lists/Greywolf.json",
  HeyImRadiant: "lists/HeyImRadiant.json",
  Jakkuba_VR: "lists/Jakkuba_VR.json",
  Kasimina: "lists/Kasimina.json",
  Kohrean: "lists/Kohrean.json",
  Krisuna: "lists/Krisuna.json",
  Kromia: "lists/Kromia.json",
  La_Wafflez: "lists/La_Wafflez.json",
  Luuna: "lists/Luuna.json",
  Puck: "lists/Puck.json",
  PuertoRicanPup: "lists/PuertoRicanPup.json",
  RadiantSoul_Tv: "lists/RadiantSoul_Tv.json",
  RadiantSoul_Tv_Sub: "lists/RadiantSoul_Tv_SubSounds.json",
  RinMunchkin: "lists/RinMunchkin.json",
  SKTKawaiiNeko: "lists/SKTKawaiiNeko.json",
  Taletrap: "lists/Taletrap.json",
  Totless: "lists/Totless.json"
};

/* ====================== */
/*   AUDIO CONTEXT & CACHE */
/* ====================== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const bufferCache = new Map();
const reversedCache = new Map();

/* ====================== */
/*     GLOBAL VARIABLES    */
/* ====================== */
let avatars = {};
let triggerImages = {};
window.__GLOBAL_SOURCES__ = [];

/* ====================== */
/*     UTILITY FUNCTIONS   */
/* ====================== */
function createElement(tag, options = {}) {
  const el = document.createElement(tag);
  Object.entries(options).forEach(([key, val]) => el[key] = val);
  return el;
}

async function fetchJSON(url) {
  const res = await fetch(url);
  return await res.json();
}

async function fetchAndDecode(url) {
  const buffer = await fetch(url).then(r => r.arrayBuffer());
  return await audioCtx.decodeAudioData(buffer);
}

/* ====================== */
/*      INIT RESOURCES      */
/* ====================== */
async function loadResources() {
  try {
    triggerImages = await fetchJSON("lists/internals/IconTriggers.json");
    avatars = await fetchJSON("lists/internals/avatars.json");
    displayUserLists();
  } catch(e) {
    console.error("Failed to load resources", e);
    document.getElementById("list").innerHTML = "<p style='color:red;'>Failed to load resources.</p>";
  }
}

/* ====================== */
/*       HASH HANDLER       */
/* ====================== */
window.addEventListener("hashchange", () => {
  const user = window.location.hash.slice(1);
  if (user && userFiles[user]) loadList(user);
  else displayUserLists();
});

/* ====================== */
/*      DARK/LIGHT MODE     */
/* ====================== */
document.getElementById("toggleMode").addEventListener("click", () => {
  document.body.classList.toggle("lightmode");
  document.getElementById("toggleMode").textContent = document.body.classList.contains("lightmode") ? "â˜€ï¸" : "ðŸŒ™";
});

/* ====================== */
/*   DISPLAY USER LISTS     */
/* ====================== */
function displayUserLists() {
  const container = document.getElementById("list");
  container.innerHTML = "";

  const searchInput = createElement("input", {
    type: "text",
    placeholder: "Search users..."
  });
  Object.assign(searchInput.style, {
    marginBottom: "15px",
    padding: "8px 12px",
    width: "300px",
    fontSize: "16px",
    borderRadius: "12px",
    border: "2px solid #000",
    background: "rgba(0,0,0,0.3)",
    backdropFilter: "blur(6px)",
    color: "#fff",
    outline: "none",
    transition: "all 0.3s ease"
  });
  searchInput.addEventListener("focus", () => searchInput.style.borderColor = "#fff");
  searchInput.addEventListener("blur", () => searchInput.style.borderColor = "#000");
  container.appendChild(searchInput);

  const userDivs = Object.keys(userFiles).map(user => {
    const div = createElement("div", { className: "sound-item", style: "cursor:pointer;" });

    const twitchImg = createElement("img", { src: avatars[user] || "https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png", alt: user });
    const link = createElement("a", { href: `https://twitch.tv/${user}`, target: "_blank" });
    link.appendChild(twitchImg);
    div.appendChild(link);

    const text = createElement("div");
    text.innerHTML = `<strong>${user}</strong><br><span>Click to view sounds</span>`;
    div.appendChild(text);

    div.addEventListener("click", e => {
      if (e.target.closest('a')) return;
      loadList(user);
    });

    container.appendChild(div);
    return { div, name: user.toLowerCase() };
  });

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    userDivs.forEach(obj => obj.div.style.display = obj.name.includes(query) ? "flex" : "none");
  });
}

/* ====================== */
/*       LOAD USER LIST     */
/* ====================== */
async function loadList(user) {
  try {
    const res = await fetch(userFiles[user]);
    const data = await res.json();
    const list = Array.isArray(data) ? data : Object.values(data).find(v => Array.isArray(v)) || [];
    window.location.hash = user;
    displayList(list, user);
  } catch (e) {
    console.error("Failed to load list", e);
    document.getElementById("list").innerHTML = "<p style='color:red;'>Failed to load list.</p>";
  }
}

/* ====================== */
/*       DISPLAY LIST       */
/* ====================== */
function displayList(list, user) {
  const container = document.getElementById("list");
  container.innerHTML = "";

  /* Back + search wrapper */
  const wrapper = createElement("div");
  Object.assign(wrapper.style, { display: "flex", justifyContent: "space-between", alignItems: "center", gap: "12px", marginBottom: "15px" });

  const backBtn = createElement("button", { textContent: "â¬… Back" });
  Object.assign(backBtn.style, { padding:"8px 12px", fontSize:"16px", color:"#fff", borderRadius:"8px", border:"2px solid #000", background:"rgba(0,0,0,0.3)", cursor:"pointer" });
  backBtn.addEventListener("click", () => window.location.hash = "");
  wrapper.appendChild(backBtn);

  const searchInput = createElement("input", { type:"text", placeholder:"Search emotes..." });
  Object.assign(searchInput.style, { padding:"10px", width:"300px", fontSize:"16px", borderRadius:"12px", border:"2px solid #000", background:"rgba(0,0,0,0.3)", backdropFilter:"blur(6px)", color:"#fff", outline:"none" });
  searchInput.addEventListener("focus", () => searchInput.style.borderColor="#fff");
  searchInput.addEventListener("blur", () => searchInput.style.borderColor="#000");
  wrapper.appendChild(searchInput);

  container.appendChild(wrapper);

  if (!list.length) { container.innerHTML += "<p>No sounds found.</p>"; return; }

  const emoteDivs = [];

  list.forEach(item => {
    if (!item.enabled || item.enabled !== "true") return;

    const div = createElement("div", { className: "sound-item", style: "position:relative; display:flex; align-items:center; gap:10px;" });

    const emoteData = triggerImages[item.trigger_word];
    const emoteAnchor = createElement("a", { href: emoteData?.link || "#", target: "_blank" });
    const emoteImg = createElement("img", { src: emoteData?.image || "https://files.catbox.moe/ab5icu.png", alt: item.trigger_word, style:"cursor:pointer; background:transparent;" });
    emoteAnchor.appendChild(emoteImg);
    div.appendChild(emoteAnchor);

    const text = createElement("div");
    text.style.flex = "1";
    text.style.overflow = "hidden";
    text.innerHTML = `<strong>${item.trigger_word}</strong><br><a href="${item.sound}" target="_blank">Sound Link</a>`;
    div.appendChild(text);

    /* Controls container */
    const controls = createElement("div");
    Object.assign(controls.style, { display:"flex", flexDirection:"column", alignItems:"flex-end", gap:"6px", minWidth:"120px" });

    const volLabel = createElement("label", { textContent:"Vol" });
    volLabel.style.fontSize="12px";
    const volInput = createElement("input", { type:"range", min:"0", max:"100", value:(typeof item.volume==="number"?Math.round(item.volume*100):50) });
    volInput.style.width="100px";
    const volWrapper = createElement("div");
    volWrapper.style.display="flex"; volWrapper.style.flexDirection="column"; volWrapper.style.alignItems="flex-end";
    volWrapper.append(volLabel, volInput);

    const pitchRow = createElement("div");
    pitchRow.style.display="flex"; pitchRow.style.alignItems="center"; pitchRow.style.gap="6px";
    const pitchLabel = createElement("label", { textContent:"Speed" });
    pitchLabel.style.fontSize="12px";
    const pitchInput = createElement("input", { type:"number", min:"50", max:"200", value:"100" });
    pitchInput.style.width="60px"; pitchInput.style.fontSize="12px";
    pitchRow.append(pitchLabel, pitchInput);

    const reverseBtn = createElement("button", { textContent:"Reverse â–¶", className:"reverse-btn" });
    const stopBtn = createElement("button", { textContent:"Stop All", className:"stop-btn" });

    controls.append(volWrapper, pitchRow, reverseBtn, stopBtn);
    div.appendChild(controls);

    /* Per-item audio state */
    const activeSources = [];

    function createReversedBuffer(srcBuffer) {
      const rev = audioCtx.createBuffer(srcBuffer.numberOfChannels, srcBuffer.length, srcBuffer.sampleRate);
      for (let c=0;c<srcBuffer.numberOfChannels;c++){
        const data = srcBuffer.getChannelData(c);
        const revData = rev.getChannelData(c);
        for (let i=0,L=data.length;i<L;i++) revData[i] = data[L-1-i];
      }
      return rev;
    }

    async function getBufferForUrl(url, loader) {
      if (bufferCache.has(url)) return bufferCache.get(url);
      loader.style.display = "flex";
      const buf = await fetchAndDecode(url);
      bufferCache.set(url, buf);
      loader.style.display = "none";
      return buf;
    }

    async function playRandomBuffer({reversed=false}={}) {
      try {
        let chosenUrl = Array.isArray(item.sound) ? item.sound[Math.floor(Math.random()*item.sound.length)] : item.sound;
        const buf = await getBufferForUrl(chosenUrl, div);
        const bufferToPlay = reversed ? (reversedCache.has(chosenUrl)?reversedCache.get(chosenUrl):reversedCache.set(chosenUrl,createReversedBuffer(buf)).get(chosenUrl)) : buf;

        const src = audioCtx.createBufferSource();
        src.buffer = bufferToPlay;
        const gainNode = audioCtx.createGain();
        gainNode.gain.value = (parseFloat(volInput.value)||50)/100;
        src.connect(gainNode).connect(audioCtx.destination);
        src.start();
        src.onended = () => { src.disconnect(); gainNode.disconnect(); activeSources.splice(activeSources.indexOf(src),1); };
        activeSources.push(src);
        window.__GLOBAL_SOURCES__.push(src);
      } catch(e){ console.error("Playback error", e); }
    }

    div.addEventListener("click", e => { if(e.target.closest('a')) return; playRandomBuffer(); });
    reverseBtn.addEventListener("click", e=>{ e.stopPropagation(); playRandomBuffer({reversed:true}); });
    stopBtn.addEventListener("click", e=>{ e.stopPropagation(); window.__GLOBAL_SOURCES__.forEach(s=>s.stop()); window.__GLOBAL_SOURCES__=[]; });

    container.appendChild(div);
    emoteDivs.push({div, trigger_word: item.trigger_word.toLowerCase()});
  });

  searchInput.addEventListener("input", ()=>{
    const q = searchInput.value.toLowerCase();
    emoteDivs.forEach(obj => obj.div.style.display = obj.trigger_word.includes(q)?"flex":"none");
  });
}

/* ====================== */
/*      INITIAL LOAD       */
/* ====================== */
window.addEventListener("DOMContentLoaded", async ()=>{
  await loadResources();
  const user = window.location.hash.slice(1);
  if(user && userFiles[user]) loadList(user);
  else displayUserLists();
});
</script>

</body>
</html>
